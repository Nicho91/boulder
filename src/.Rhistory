summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
View(dosing_daily)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
View(flow_hourly)
View(mixed_liqour_hourly)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
View(mixed_liqour_hourly)
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
View(dosing_daily_mols)
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
View(mixed_liqour_hourly)
View(flow_hourly)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
View(flow_hourly)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
View(phosfax_hourly)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
View(mix_phos)
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
ggplot(data = mix_phos) + geom_point(date, phos_change)
ggplot(data = mix_phos) + geom_point(aes(date, phos_change))
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE)
View(mix_phos_flow)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
View(dosing_daily_mols)
class(mix_phos_flow$time)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
class(mix_phos_flow$date)
mix_phos_flow$date <- as.POSIXct(mix_phos_flow$date)
class(mix_phos_flow$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as.POSIXct(mix_phos_flow$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
class(dosing_daily_mols$date)
dosing_daily_mols$date <- as.POSIXct(dosing_daily_mols$date)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as.POSIXct(strptime(dosing_daily_mols$date))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as.POSIXct(mix_phos_flow$date)
dosing_daily_mols$date <- as.POSIXct(dosing_daily_mols$date)
dosing_daily_mols$date <- strptime(dosing_daily_mols, format = "%Y-%m-%d %H:%M:%S")
dosing_daily_mols$date <- strptime(dosing_daily_mols$date, format = "%Y-%m-%d %H:%M:%S")
dosing_daily_mols$date <- strptime(dosing_daily_mols$date, format = "%Y-%m-%d %H:%M:%S")
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as.POSIXct(dosing_daily_mols$date)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as.POSIXct(dosing_daily_mols$date, format = "%Y-%m-%d")
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as.POSIXct(dosing_daily_mols$date)
dosing_daily_mols$date <- ymd(dosing_daily_mols$date)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- ymd(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as.POSIXct(mix_phos_flow$date)
dosing_daily_mols$date <- ymd(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
class(dosing_daily_mols$date)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as.POSIXct(strptime(dosing_daily_mols$date, format = "%Y-%m-%d %H:%M:%S"))
dosing_daily_mols$date <- as.POSIXct(strptime(dosing_daily_mols$date))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
dosing_daily_mols$date <- as_datetime(dosing_daily_mols$date)
class(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
View(full_ancova)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
class(mix_phos_flow$date)
mix_phos_flow$date <- as_datetime(mix_phos_flow$date)
dosing_daily_mols$date <- as_datetime(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date")
View(full_ancova)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date") %>%
select(date, time, coagulant, everything())
?ymd_hms
test <- with(full_ancova, ymd_hms(paste(as.character(date), time, sep = ' ')))
test
full_ancova$date <- with(full_ancova, ymd_hms(paste(as.character(date), time, sep = ' ')))
full_ancova <- full_ancova %>% select(-time)
View(full_ancova)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as_datetime(mix_phos_flow$date)
dosing_daily_mols$date <- as_datetime(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date") %>%
select(date, time, coagulant, everything())
full_ancova$date <- with(full_ancova, ymd_hms(paste(as.character(date), time, sep = ' ')))
full_ancova <- full_ancova %>% select(-time) %>%
filter(coagulant == "Ferric" | coagulant == "Alum")
full_ancova$centrate_gal[is.na(full_ancova$centrate_gal)] <- 0
full_ancova <- full_ancova %>%
filter(date(date) != ymd("2019-08-30") & date(date) != ymd("2019-09-02"))
full_ancova <- full_ancova %>%
filter(date(date) < ymd("2019-11-13") | date(date) > ymd("2019-12-01"))
View(full_ancova)
for (i in 8:12) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(influent_mgd_hourly_avg))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(influent_mgd_hourly_avg) %>%
summarise(mean(influent_mgd_hourly_avg, na.rm = TRUE))
full_ancova$influent_mgd_hourly_avg[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(mlws_flow_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(mlws_flow_gpm) %>%
summarise(mean(mlws_flow_gpm, na.rm = TRUE))
full_ancova$mlws_flow_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
for (i in 7:13) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(abi_mgd))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(abi_mgd) %>%
summarise(mean(abi_mgd, na.rm = TRUE))
full_ancova$abi_mgd[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(ras_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(ras_gpm) %>%
summarise(mean(ras_gpm, na.rm = TRUE))
full_ancova$ras_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
full_ancova <- full_ancova %>%
filter(mlws_flow_gpm > 100) %>%
select(-twas_flow_gal)
ferr_data <- full_ancova %>% filter(coagulant == "Ferric")
alum_data <- full_ancova %>% filter(coagulant == "Alum")
colnames(dosing_daily_mols)
colnames(full_ancova)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as_datetime(mix_phos_flow$date)
dosing_daily_mols$date <- as_datetime(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date") %>%
select(date, time, coagulant, everything())
full_ancova$date <- with(full_ancova, ymd_hms(paste(as.character(date), time, sep = ' ')))
full_ancova <- full_ancova %>% select(-time) %>%
filter(coagulant == "Ferric" | coagulant == "Alum")
full_ancova$centrate_gal[is.na(full_ancova$centrate_gal)] <- 0
# morning talk thursday
full_ancova <- full_ancova %>%
filter(date(date) != ymd("2019-08-30") & date(date) != ymd("2019-09-02"))
full_ancova <- full_ancova %>%
filter(date(date) < ymd("2019-11-13") | date(date) > ymd("2019-12-01"))
# look at NA's
for (i in 8:12) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(influent_mgd_hourly_avg))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(influent_mgd_hourly_avg) %>%
summarise(mean(influent_mgd_hourly_avg, na.rm = TRUE))
full_ancova$influent_mgd_hourly_avg[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(mlws_flow_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(mlws_flow_gpm) %>%
summarise(mean(mlws_flow_gpm, na.rm = TRUE))
full_ancova$mlws_flow_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
for (i in 7:13) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(abi_mgd))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(abi_mgd) %>%
summarise(mean(abi_mgd, na.rm = TRUE))
full_ancova$abi_mgd[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(ras_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(ras_gpm) %>%
summarise(mean(ras_gpm, na.rm = TRUE))
full_ancova$ras_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
full_ancova <- full_ancova %>%
filter(mlws_flow_gpm > 100) %>%
select(-twas_flow_gal) %>%
select(date, coagulant, mols_of_metal_kmol_day, influent_mgd_hourly_avg, everything())
colnames(full_ancova)
rm( list = ls() )
library(tidyverse)
library(fields)
library(lubridate)
library(latex2exp)
# make sure src is the current working directory
load("../data/boulderMoWater.rda")
# add the hour for grouping and averaging hourly
phosfax_hourly <- phosfax_10m %>%
mutate(hour = hour(date)) %>%
group_by(date = date(date), hour) %>%
summarise(op_conc_mg_p_l_hourly = mean(op_conc_mg_p_l, na.rm = TRUE)) %>%
ungroup()
# turn the date back into one posixct object and eliminate the hour column
phosfax_hourly$date <- with(phosfax_hourly, ymd_h(paste(date, hour, sep= ' ')))
phosfax_hourly <- phosfax_hourly %>% select(date, op_conc_mg_p_l_hourly)
# similar as above get into the same format. just include the hour of the day
mixed_liqour_hourly <- mixed_liqour_hourly %>%
mutate(hour = hour(date)) %>%
mutate(date = date(date))
mixed_liqour_hourly$date <- with(mixed_liqour_hourly, ymd_h(paste(date, hour, sep= ' ')))
mixed_liqour_hourly <- mixed_liqour_hourly %>% select(1:2)
# variables Kate recommended we can remove
del_vars <- c("influent_mgd_daily_avg", "primary_sludge_gmp_daily_avg", "primary_sludge_gal", "thickened_sludge_gal",
"gvt_o_f_gpm", "daft_sub_gpm", "daft_sub_gal", "twas_flow_gpm_daily_avg")
flow_hourly <- flow_hourly %>%
select(-all_of(del_vars))
# only grab the day and coagulant to be merged later
dosing_daily_mols <- dosing_daily[,c(1:2,7)]
dosing_daily_mols$coagulant <- as.factor(dosing_daily_mols$coagulant)
mix_phos <- inner_join(mixed_liqour_hourly, phosfax_hourly, by = "date")
mix_phos <- tibble(date = mix_phos$date, phos_change = mix_phos$op_conc_mg_p_l_hourly-mix_phos$op_mg_p_l)
mix_phos_flow <- inner_join(mix_phos, flow_hourly, by = "date")
# 107 observation at this point. included coagulant, flow, and op change
mix_phos_flow <- mix_phos_flow %>% mutate(date = ymd_hms(date)) %>%
separate(date, into = c('date', 'time'), sep=' ', remove = FALSE) %>%
select(date, time, everything())
mix_phos_flow$date <- as_datetime(mix_phos_flow$date)
dosing_daily_mols$date <- as_datetime(dosing_daily_mols$date)
full_ancova <- inner_join(mix_phos_flow, dosing_daily_mols, by = "date") %>%
select(date, time, coagulant, everything())
full_ancova$date <- with(full_ancova, ymd_hms(paste(as.character(date), time, sep = ' ')))
full_ancova <- full_ancova %>% select(-time) %>%
filter(coagulant == "Ferric" | coagulant == "Alum")
full_ancova$centrate_gal[is.na(full_ancova$centrate_gal)] <- 0
# morning talk thursday
full_ancova <- full_ancova %>%
filter(date(date) != ymd("2019-08-30") & date(date) != ymd("2019-09-02"))
full_ancova <- full_ancova %>%
filter(date(date) < ymd("2019-11-13") | date(date) > ymd("2019-12-01"))
# look at NA's
for (i in 8:12) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(influent_mgd_hourly_avg))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(influent_mgd_hourly_avg) %>%
summarise(mean(influent_mgd_hourly_avg, na.rm = TRUE))
full_ancova$influent_mgd_hourly_avg[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(mlws_flow_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(mlws_flow_gpm) %>%
summarise(mean(mlws_flow_gpm, na.rm = TRUE))
full_ancova$mlws_flow_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
for (i in 7:13) {
temp <- full_ancova %>% filter(hour(date) == i & is.na(abi_mgd))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(abi_mgd) %>%
summarise(mean(abi_mgd, na.rm = TRUE))
full_ancova$abi_mgd[full_ancova$date == temp$date] <- as.numeric(value)
temp <- full_ancova %>% filter(hour(date) == i & is.na(ras_gpm))
value <- full_ancova %>%
filter(hour(date) == i) %>%
select(ras_gpm) %>%
summarise(mean(ras_gpm, na.rm = TRUE))
full_ancova$ras_gpm[full_ancova$date == temp$date] <- as.numeric(value)
}
full_ancova <- full_ancova %>%
filter(mlws_flow_gpm > 100) %>%
select(-twas_flow_gal) %>%
select(date, coagulant, mols_of_metal_kmol_day, influent_mgd_hourly_avg, everything())
ferr_data <- full_ancova %>% filter(coagulant == "Ferric")
alum_data <- full_ancova %>% filter(coagulant == "Alum")
save(full_ancova, ferr_data, alum_data, file = "../data/final-data.rda")
class(full_ancova$date)
